/**
 * Novalnet payment module
 *
 * This script loads the form and gets the server's pan hash
 *
 * @author     Novalnet AG
 * @copyright  Copyright (c) Novalnet
 * @license    https://www.novalnet.de/payment-plugins/kostenlos/lizenz
 * @link       https://www.novalnet.de
 *
 * Script: novalnet_cc.min.js
 */
window.onload=function(){jQuery('input[name="payment"]').click((function(){"novalnet_cc"==jQuery(this).val()&&document.querySelector("#novalnet_iframe")&&(document.querySelector("#novalnet_iframe").parentElement.classList.remove("col-md-8"),document.querySelector("#novalnet_iframe").parentElement.classList.add("col-md-12"))})),novalnet_cc={init:function(){novalnet_cc.load_iframe(),$(".cc_token").click((function(){var e={action:"delete_token",id:this.id};$.ajax({type:"POST",url:"novalnet_token_delete.php",data:e,success:function(e){location.reload()}})})),jQuery('input[name="payment"]').click((function(){"novalnet_cc"==jQuery(this).val()&&NovalnetUtility.setCreditCardFormHeight()})),jQuery("#novalnet_cc_new").click((function(){jQuery("#novalnet_iframe").show(),jQuery("#cc_save_card").show(),"1"==jQuery(this).attr("data-reload")&&(novalnet_cc.load_iframe(),jQuery(this).attr("data-reload","0"))})),jQuery(".novalnet_cc_saved_acc").click((function(){jQuery("#novalnet_iframe").hide(),jQuery("#cc_save_card").hide()}))},load_iframe:function(){var e=jQuery("#nn_css_label").val(),r=jQuery("#nn_css_input").val(),a=jQuery("#nn_css_text").val(),n=jQuery("#nn_cc_iframe_data").val(),t=JSON.parse(n),i=void 0!==t.client_key?t.client_key:"";if("0"==jQuery("#nn_shipping").val())var o={first_name:void 0!==t.first_name?t.first_name:"",last_name:void 0!==t.last_name?t.last_name:t.first_name,email:void 0!==t.email_address?t.email_address:"",street:void 0!==t.street_address?t.street_address:"",city:void 0!==t.city?t.city:"",zip:void 0!==t.postcode?t.postcode:"",country_code:void 0!==t.country?t.country:""};else o={same_as_billing:"1"};document.getElementById("novalnet_iframe").contentWindow;NovalnetUtility.setClientKey(i);var l={callback:{on_success:function(e){return jQuery("#nn_pan_hash").val(e.hash),jQuery("#nn_uniqueid").val(e.unique_id),jQuery("#do_redirect").val(e.do_redirect),$("#checkout_payment").submit(),!0},on_error:function(e){if(void 0!==e.error_message)return alert(e.error_message),!1}},iframe:{id:"novalnet_iframe",inline:void 0!==t.inline_form?t.inline_form:"0",style:{container:void 0!==a?a:"",input:void 0!==r?r:"",label:void 0!==e?e:""},text:{lang:void 0!==t.lang?t.lang:"",error:void 0!==t.iframe_error?t.iframe_error:"",card_holder:{label:void 0!==t.iframe_holder_label?t.iframe_holder_label:"",place_holder:void 0!==t.iframe_holder_input?t.iframe_holder_input:"",error:void 0!==t.iframe_holder_error?t.iframe_holder_error:""},card_number:{label:void 0!==t.iframe_number_label?t.iframe_number_label:"",place_holder:void 0!==t.iframe_number_input?t.iframe_number_input:"",error:void 0!==t.iframe_number_error?t.iframe_number_error:""},expiry_date:{label:void 0!==t.iframe_expire_label?t.iframe_expire_label:"",error:void 0!==t.iframe_expire_error?t.iframe_expire_error:""},cvc:{label:void 0!==t.iframe_cvc_label?t.iframe_cvc_label:"",place_holder:void 0!==t.iframe_cvc_input?t.iframe_cvc_input:"",error:void 0!==t.iframe_cvc_error?t.iframe_cvc_error:""}}},customer:{first_name:void 0!==t.first_name?t.first_name:"",last_name:void 0!==t.last_name?t.last_name:t.first_name,email:void 0!==t.email_address?t.email_address:"",billing:{street:void 0!==t.street_address?t.street_address:"",city:void 0!==t.city?t.city:"",zip:void 0!==t.postcode?t.postcode:"",country_code:void 0!==t.country?t.country:""},shipping:o},transaction:{amount:void 0!==t.amount?t.amount:"",currency:void 0!==t.currency?t.currency:"",test_mode:void 0!==t.test_mode?t.test_mode:"0",enforce_3d:void 0!==t.enforce_3d?t.enforce_3d:"0"},custom:{lang:void 0!==t.lang?t.lang:"DE"}};NovalnetUtility.createCreditCardForm(l)}},jQuery(document).ready((function(){novalnet_cc.init()}))},document.getElementById("checkout_payment").onsubmit=function(e){(document.getElementsByName("payment").length>1&&"novalnet_cc"==document.querySelector('input[name="payment"]:checked').value||"novalnet_cc"==document.querySelector('input[name="payment"]').value)&&jQuery("#novalnet_iframe").is(":visible")&&null!=jQuery("#nn_pan_hash").val()&&""==jQuery("#nn_pan_hash").val()&&(e.preventDefault(),e.stopImmediatePropagation(),NovalnetUtility.getPanHash())};