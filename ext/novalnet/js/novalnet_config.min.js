/**
 * Novalnet payment module
 *
 * This script is used for auto configuration of merchant credentials
 * and webhook URL configuration
 *
 * @author     Novalnet AG
 * @copyright  Copyright (c) Novalnet
 * @license    https://www.novalnet.de/payment-plugins/kostenlos/lizenz
 * @link       https://www.novalnet.de
 *
 * Script: novalnet_config.min.js
 */
function novalnet_api_load(){jQuery('input[name="configuration[configuration/MODULE_PAYMENT_NOVALNET_SIGNATURE]"]').attr("id","novalnet_signature").attr("autocomplete","off"),jQuery('input[name="configuration[configuration/MODULE_PAYMENT_NOVALNET_TARIFF_ID]"]').attr("id","novalnet_tariff_id"),jQuery('input[name="configuration[configuration/MODULE_PAYMENT_NOVALNET_CLIENT_KEY]"]').attr("id","novalnet_client_key"),jQuery('input[name="configuration[configuration/MODULE_PAYMENT_NOVALNET_PAYMENT_ACCESS_KEY]"]').attr("id","novalnet_access_key").attr("autocomplete","off"),jQuery('input[name="configuration[configuration/MODULE_PAYMENT_NOVALNET_PROJECT_ID]"]').attr("id","novalnet_product_id"),jQuery('input[name="configuration[configuration/MODULE_PAYMENT_NOVALNET_CALLBACK_URL]"]').attr("id","novalnet_webhook_url"),jQuery('input[name="configuration[configuration/MODULE_PAYMENT_NOVALNET_CALLBACK_URL]"]').attr("readonly",!0),jQuery("#novalnet_signature, #novalnet_access_key").change((function(){if(""!=jQuery("#novalnet_signature").val()&&""!=jQuery("#novalnet_access_key").val())return get_merchant_details(),!0;""==jQuery("#novalnet_signature").val()&&""==jQuery("#novalnet_access_key").val()&&clear_basic_params()})).change(),""!=jQuery("#novalnet_webhook_url").val()&&null!=jQuery("#novalnet_webhook_url").val()&&jQuery("#webhook_url_button").on("click",(function(){var e=jQuery.trim(jQuery("#novalnet_webhook_url").val()),n=/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/;return""!=e&&n.test(e)?!!confirm(jQuery("#nn_webhook_alert").val())&&(configure_webhook(),!0):n.test(e)&&""!==e&&void 0!==e?void 0:(alert(jQuery("#nn_webhook_error").val()),!1)}))}function get_merchant_details(){return do_ajax_call({action:"merchant",signature:jQuery.trim(jQuery("#novalnet_signature").val()),access_key:jQuery.trim(jQuery("#novalnet_access_key").val()),lang:jQuery("#nn_language").val()},"merchant"),!0}function configure_webhook(){var e=jQuery.trim(jQuery("#novalnet_signature").val()),n=jQuery.trim(jQuery("#novalnet_access_key").val()),a=jQuery.trim(jQuery("#novalnet_webhook_url").val()),t=jQuery("#nn_language").val();return""==e||""==n?(alert(jQuery("#nn_key_error").val()),clear_basic_params(),!1):(do_ajax_call({action:"webhook",signature:e,access_key:n,webhook_url:a,lang:t},"webhook"),!0)}function process_result(e){var n=jQuery("#novalnet_tariff_id").val();jQuery("#novalnet_tariff_id").replaceWith('<select id="novalnet_tariff_id" name= "configuration[configuration/MODULE_PAYMENT_NOVALNET_TARIFF_ID]" ></select>');var a=e.merchant.tariff;$("#novalnet_client_key").val(e.merchant.client_key),$("#novalnet_product_id").val(e.merchant.project),null!=a?jQuery.each(a,(function(e,a){var t=e;jQuery("#novalnet_tariff_id").append(jQuery("<option>",{value:jQuery.trim(t),text:jQuery.trim(a.name)})),null!=n&&n==t&&jQuery("#novalnet_tariff_id").val(t)})):(clear_basic_params(),alert(e.status_desc))}function clear_basic_params(){jQuery("#novalnet_access_key").val(""),jQuery("#novalnet_client_key").val(""),jQuery("#novalnet_product_id").val(""),jQuery("#novalnet_tariff_id").find("option").remove(),jQuery("#novalnet_tariff_id").append(jQuery("<option>",{value:"",text:""}))}function do_ajax_call(e,n){jQuery.ajax({type:"POST",url:"../novalnet_auto_config.php",data:e,success:function(e){var a=JSON.parse(e);"merchant"==n?process_result(a):"webhook"==n&&(100==a.result.status_code?alert(jQuery("#nn_webhook_text").val()):alert(jQuery("#nn_webhook_alert").val()))}})}window.addEventListener?window.addEventListener("load",novalnet_api_load):window.attachEvent&&window.attachEvent("onload",novalnet_api_load);